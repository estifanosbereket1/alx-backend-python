#!/bin/bash

set -e

echo "ğŸš€ Deploying BLUE version..."
kubectl apply -f messaging_app/blue_deployment.yaml

echo "ğŸš€ Deploying GREEN version..."
kubectl apply -f messaging_app/green_deployment.yaml

echo "ğŸ”§ Applying Service..."
kubectl apply -f messaging_app/kubeservice.yaml

echo "ğŸ§ª Checking logs for GREEN pods..."
GREEN_PODS=$(kubectl get pods -l version=green -o jsonpath='{.items[*].metadata.name}')

for pod in $GREEN_PODS; do
  echo "ğŸ” Logs for pod: $pod"
  kubectl logs "$pod"
done

echo "âœ… Done. Green and Blue deployed. Update Service selector to switch traffic."
